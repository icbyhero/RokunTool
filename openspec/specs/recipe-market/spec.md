# recipe-market Specification

## Purpose
TBD - created by archiving change enhance-rime-recipe-market. Update Purpose after archive.
## Requirements
### Requirement: 配方分类组织

插件MUST将 Rime Plum 配方按逻辑分类组织,帮助用户浏览和发现配方。

#### Scenario: 按分类显示配方

- **当** 用户打开配方市场时
- **则** 配方MUST按以下分类组织:
  - 基础配置
  - 词库配方
  - 拼音输入
  - 双拼方案
  - 方言输入
  - 笔画输入
  - 符号输入
  - 工具类
- **并且** 每个分类MUST有描述性名称
- **并且** 每个分类MUST有图标表示

#### Scenario: 按分类筛选配方

- **当** 用户选择分类标签时
- **则** 只显示该分类中的配方
- **并且** 选中的标签MUST高亮显示
- **并且** 用户MUST能够返回"全部配方"视图

#### Scenario: 显示配方分类信息

- **当** 查看配方卡片时
- **则** MUST显示配方的分类
- **并且** MUST显示分类图标
- **并且** 鼠标悬停或点击时可获得分类描述

---

### Requirement: 文件冲突检测与自动卸载

插件MUST检测配方安装时的文件冲突,并自动卸载冲突的配方。

#### Scenario: 安装前检测文件冲突

- **假设** 配方 A 定义了文件列表 ['rime_ice.dict.yaml', 'default.custom.yaml']
- **并且** 配方 A 已安装
- **并且** 配方 B 定义了文件列表 ['essay.dict.yaml', 'default.custom.yaml']
- **当** 用户尝试安装配方 B 时
- **则** 插件MUST检测到 `default.custom.yaml` 文件冲突
- **并且** 插件MUST识别配方 A 为冲突配方
- **并且** 插件MUST自动卸载配方 A (删除标记文件)
- **并且** 插件MUST在日志中记录卸载操作和冲突文件

#### Scenario: 自动卸载冲突配方

- **假设** 检测到多个配方与要安装的配方冲突
- **当** 执行安装时
- **则** 系统MUST自动卸载所有冲突的配方
- **并且** 系统MUST只删除标记文件,不删除其他配方文件
- **并且** 冲突文件MUST被新配方的文件覆盖
- **并且** 被卸载的配方不再显示为"已安装"

#### Scenario: 记录冲突和卸载信息

- **当** 检测到文件冲突并自动卸载时
- **则** 系统MUST记录以下信息:
  - 被卸载配方的名称和 ID
  - 冲突文件列表
  - 卸载时间
- **并且** 日志级别MUST为 `info`
- **并且** 日志MUST包含可读的冲突描述

---

### Requirement: 扩展配方列表

插件MUST提供官方 Rime 配方仓库中的综合配方列表。

#### Scenario: 包含官方词库配方

- **当** 用户浏览配方市场时
- **则** 以下词库配方MUST可用:
  - `rime_ice` - 雾凇拼音
  - `essay` - 八股文词汇表
  - `octagram` - 八股文语言模型
- **并且** 每个配方MUST显示名称、描述和分类

#### Scenario: 包含官方输入法配方

- **当** 用户浏览配方市场时
- **则** 以下输入法配方MUST可用:
  - `luna_pinyin` - 朙月拼音
  - `terra_pinyin` - 地球拼音
  - `double_pinyin` - 双拼
  - `combo_pinyin` - 宫保拼音
  - `stroke` - 五笔画
  - `wubi` - 五笔
  - `cangjie` - 仓颉
  - `quick` - 速成
  - `sancang` - 三码仓颉
  - `wubi98` - 五笔98版
  - `zhengma` - 郑码
- **并且** 每个配方MUST显示名称、描述和分类

#### Scenario: 包含方言输入配方

- **当** 用户浏览配方市场时
- **则** 以下方言输入配方MUST可用:
  - `jyutping` - 粤拼
  - `wugniu` - 吴语上海话
- **并且** 每个配方MUST显示名称、描述和分类

#### Scenario: 包含符号输入配方

- **当** 用户浏览配方市场时
- **则** 以下符号输入配方MUST可用:
  - `emoji` - 绘文字
  - `ipa` - 国际音标
- **并且** 每个配方MUST显示名称、描述和分类

#### Scenario: 包含工具配方

- **当** 用户浏览配方市场时
- **则** 以下工具配方MUST可用:
  - `prelude` - 基础配置
  - `opencc` - OpenCC 简繁转换
- **并且** 每个配方MUST显示名称、描述和分类

---

### Requirement: 配方搜索和筛选

插件MUST提供搜索和筛选功能,帮助用户快速找到配方。

#### Scenario: 按名称搜索配方

- **当** 用户在搜索框中输入搜索查询时
- **则** MUST显示名称或描述中匹配的配方
- **并且** 不匹配的配方MUST隐藏
- **并且** 搜索MUST不区分大小写
- **并且** 搜索结果MUST随着用户输入实时更新

#### Scenario: 清除搜索结果

- **当** 用户清除搜索框时
- **则** 所有配方MUST再次显示
- **并且** 如果之前选择了分类过滤器,分类过滤器MUST保持激活

#### Scenario: 结合搜索和分类筛选

- **假设** 用户已选择一个分类
- **当** 用户输入搜索查询时
- **则** 只显示选定分类中匹配的配方
- **并且** 两个过滤器MUST正确协同工作

---

### Requirement: 配方安装确认

插件MUST在执行关键操作前提供清晰的确认对话框。

#### Scenario: 确认有互斥冲突的配方安装

- **假设** 配方 A 与已安装的配方 B 冲突
- **当** 用户发起安装配方 A
- **则** MUST显示确认对话框
- **并且** 对话框MUST显示:
  - 冲突配方的名称(配方 B)
  - 只能安装一种词库配方的说明
  - 配方 B 将被卸载的警告
- **并且** 用户MUST有取消或继续的选项
- **并且** 继续MUST卸载 B 并安装 A

#### Scenario: 确认配方卸载

- **当** 用户发起配方卸载时
- **则** MUST显示确认对话框
- **并且** 对话框MUST显示:
  - 要卸载的配方名称
  - 配置文件可能被删除的警告
- **并且** 用户MUST有取消或确认的选项
- **并且** 确认MUST继续执行卸载

---

