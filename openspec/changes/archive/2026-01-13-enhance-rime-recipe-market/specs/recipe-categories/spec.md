# 配方分类规格增量

## ADDED Requirements

### Requirement: 配方分类元数据

每个配方分类MUST有结构化元数据,以便 UI 一致展示。

#### Scenario: 定义分类元数据

- **当** 系统初始化配方分类时
- **则** 每个分类MUST有:
  - 唯一标识符 (如 'basic', 'vocabulary')
  - 中文显示名称 (如 '基础配置', '词库配方')
  - 说明分类用途的描述
  - 用于 UI 渲染的图标名称

#### Scenario: 显示分类信息

- **当** UI 渲染分类标签或标签页时
- **则** 每个分类MUST显示其图标
- **并且** MUST显示分类名称
- **并且** 鼠标悬停或工具提示中MUST提供分类描述

---

### Requirement: 配方文件列表定义

每个配方MUST定义它会创建/修改的文件列表,用于文件冲突检测和自动卸载。

#### Scenario: 定义配方文件列表

- **当** 定义配方时
- **则** MUST包含 `files` 字段,列出所有会创建/修改的文件
- **并且** 文件路径MUST相对于 Rime 用户目录
- **并且** 文件列表MUST包含:
  - 字典文件 (*.dict.yaml)
  - 输入方案文件 (*.schema.yaml)
  - 配置文件 (*.custom.yaml)
  - 其他相关文件

#### Scenario: 使用文件列表检测冲突并卸载

- **假设** 配方 A 定义了文件列表 ['rime_ice.dict.yaml', 'default.custom.yaml']
- **并且** 配方 B 定义了文件列表 ['essay.dict.yaml', 'default.custom.yaml']
- **并且** 配方 A 已安装
- **当** 用户安装配方 B 时
- **则** 系统MUST检测到 `default.custom.yaml` 文件冲突
- **并且** 系统MUST自动卸载配方 A (删除标记文件)
- **并且** 系统MUST在日志中记录卸载操作
- **并且** 配方 B 安装后MUST覆盖 `default.custom.yaml`
- **并且** 配方 A 不再显示为"已安装"

---

### Requirement: 基于分类的配方筛选

UI MUST提供直观的基于分类的配方筛选功能。

#### Scenario: 默认显示"全部配方"视图

- **当** 用户首次打开配方市场时
- **则** MUST显示所有分类的所有配方
- **并且** MUST默认选中"全部"标签页
- **并且** 配方MUST在视图中按分类分组

#### Scenario: 在分类之间切换

- **当** 用户点击分类标签时
- **则** 视图MUST立即切换,仅显示该分类中的配方
- **并且** 选中的标签MUST在视觉上高亮显示
- **并且** 其他标签MUST显示为未选中状态
- **并且** 过渡MUST流畅并有动画效果

#### Scenario: 切换分类时保持搜索状态

- **假设** 用户已输入搜索查询
- **当** 用户切换到不同分类时
- **则** 搜索查询MUST保持激活状态
- **并且** MUST仅显示新分类中匹配的配方
- **并且** 搜索框MUST继续显示查询内容

---

### Requirement: 配方分类图标

每个配方分类MUST由一个独特的、语义适当的图标表示。

#### Scenario: 定义分类图标

- **当** 定义分类时
- **则** 每个分类MUST分配一个图标:
  - 基础配置 → `settings` 图标
  - 词库配方 → `book` 图标
  - 拼音输入 → `keyboard` 图标
  - 双拼方案 → `keyboard` 图标
  - 方言输入 → `globe` 图标
  - 笔画输入 → `edit` 或 `pen-tool` 图标
  - 符号输入 → `smile` 或 `emoji` 图标
  - 工具类 → `tool` 或 `wrench` 图标

#### Scenario: 一致显示分类图标

- **当** UI 渲染分类信息时
- **则** 图标MUST显示在:
  - 分类标签页
  - 配方卡片
  - 分类标签
- **并且** 图标大小MUST一致
- **并且** 图标颜色MUST与应用主题匹配

---

### Requirement: 配方自动卸载冲突配方

当安装新配方时,系统MUST自动卸载会生成冲突文件的已安装配方。

#### Scenario: 自动卸载冲突的词库配方

- **假设** 配方 A (rime_ice) 已安装
- **并且** 配方 B (essay) 与配方 A 有文件冲突
- **当** 用户安装配方 B 时
- **则** 系统MUST自动卸载配方 A
- **并且** 系统MUST删除配方 A 的标记文件
- **并且** 系统MUST在日志中记录卸载操作
- **并且** 配方 A 不再显示为"已安装"
- **并且** 配方 B 安装后MUST覆盖冲突文件

#### Scenario: 允许多个无冲突配方

- **假设** 用户已安装"朙月拼音" (luna_pinyin)
- **并且** "地球拼音" (terra_pinyin) 与"朙月拼音"无文件冲突
- **当** 用户安装"地球拼音"时
- **则** 两个配方都MUST显示为"已安装"
- **并且** 两个配方都MUST可用
- **并且** 用户可以通过 F4 切换方案
- **并且** 不应触发自动卸载

#### Scenario: 记录自动卸载信息

- **当** 自动卸载冲突配方时
- **则** 系统MUST记录:
  - 被卸载配方的名称
  - 卸载原因 (冲突文件列表)
  - 卸载时间
- **并且** 日志级别MUST为 `info`
- **并且** 日志MUST包含可读的描述

---