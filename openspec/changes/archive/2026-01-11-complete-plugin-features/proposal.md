# Change: 完成插件核心功能和测试框架

## Why

当前项目已完成44.95%(98/218任务),核心框架和基础UI已就绪,但还存在关键功能缺失:
1. Rime插件的配置编辑器和词库管理功能尚未实现
2. 两个插件的冒烟测试尚未完成
3. 缺少单元测试和集成测试框架
4. 缺少性能优化和安全审计

为了确保项目质量和可发布性,需要优先完成这些核心功能,建立测试体系,并进行必要的优化。

## What Changes

- **实现Rime配置编辑器增强功能** (Section 4.6.1-4.6.3)
  - 配置文件语法高亮和自动补全
  - 实时YAML语法验证
  - 配置文件格式化和diff对比
  - 字典文件管理(列表、下载、更新、导入导出)
  - 配置备份和恢复功能

- **建立测试框架** (Section 5.1-5.2)
  - 配置Vitest测试框架
  - 编写核心功能单元测试(插件加载器、权限系统、IPC通信、服务层)
  - 编写集成测试(E2E测试、插件加载/卸载流程、权限申请流程)

- **性能优化** (Section 5.3)
  - 优化应用启动时间(<3秒目标)
  - 优化插件加载速度(<1秒目标)
  - 优化UI渲染性能(<100ms目标)
  - 优化内存占用(<300MB空载目标)

- **文档补充** (Section 3.6.3, 4.7.3)
  - 添加插件界面截图
  - 创建功能演示视频(可选)

## Impact

- **Affected specs**:
  - `plugin-system`: 增加测试要求和性能指标
  - `rime-config`: 完善配置编辑器和词库管理功能
  - `wechat-multi-instance`: 补充测试和文档

- **Affected code**:
  - `rokun-tool/plugins/rime-config/` - 添加配置编辑器UI组件和词库管理功能
  - `rokun-tool/` - 添加Vitest配置和测试文件
  - `rokun-tool/src/main/` - 性能优化
  - `rokun-tool/src/renderer/` - UI渲染优化
  - `docs/plugins/` - 补充截图和演示

- **Dependencies**:
  - Vitest (测试框架)
  - @testing-library/react (组件测试)
  - Monaco Editor (代码编辑器,用于配置编辑器)
  - js-yaml (YAML验证和解析)
  - diff2html (配置diff对比显示)

- **Risks**:
  - Monaco Editor会增加打包体积 (~30MB) → 考虑懒加载或使用轻量级替代方案
  - 测试编写时间可能较长 → 优先覆盖核心功能,逐步扩展
  - 性能优化可能需要重构部分代码 → 在优化前做好性能基准测试

## Success Criteria

- [ ] Rime配置编辑器支持语法高亮、实时验证、格式化
- [ ] Rime词库管理支持导入/导出/下载/更新
- [ ] 配置备份和恢复功能可用
- [ ] 单元测试覆盖率 > 60% (核心模块)
- [ ] 集成测试覆盖主要用户流程
- [ ] 应用启动时间 < 3秒
- [ ] 插件加载时间 < 1秒
- [ ] UI响应时间 < 100ms
- [ ] 内存占用 < 300MB (空载)
- [ ] 两个插件文档包含截图
