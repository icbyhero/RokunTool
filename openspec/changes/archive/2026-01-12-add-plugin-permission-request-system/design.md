# æ’ä»¶æƒé™è¯·æ±‚ç³»ç»Ÿ - è®¾è®¡æ–‡æ¡£

## æ¶æ„è®¾è®¡

### ç³»ç»Ÿç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Renderer Process                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Plugin UI      â”‚â”€â”€â”€â”€â”€â–¶â”‚ PermissionDialog         â”‚      â”‚
â”‚  â”‚                â”‚      â”‚ (Modal)                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚                          â”‚                       â”‚
â”‚          â”‚ IPC calls                â”‚                       â”‚
â”‚          â–¼                          â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ IPC Bridge                                        â”‚     â”‚
â”‚  â”‚ - plugin:callMethod                             â”‚     â”‚
â”‚  â”‚ - permission:request                            â”‚     â”‚
â”‚  â”‚ - permission:check                              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ IPC
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Main Process                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ IPC Handlers                                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ PermissionManager                                 â”‚     â”‚
â”‚  â”‚                                                    â”‚     â”‚
â”‚  â”‚ Methods:                                          â”‚     â”‚
â”‚  â”‚ - checkPermission(pluginId, permission)           â”‚     â”‚
â”‚  â”‚ - requestPermission(pluginId, permission, reason) â”‚     â”‚
â”‚  â”‚ - grantPermission(pluginId, permission)           â”‚     â”‚
â”‚  â”‚ - revokePermission(pluginId, permission)          â”‚     â”‚
â”‚  â”‚ - getPermissionStatus(pluginId)                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ PermissionStore (Storage)                         â”‚     â”‚
â”‚  â”‚                                                    â”‚     â”‚
â”‚  â”‚ Format:                                           â”‚     â”‚
â”‚  â”‚ {                                                 â”‚     â”‚
â”‚  â”‚   "plugin-id": {                                  â”‚     â”‚
â”‚  â”‚     "permissions": {                              â”‚     â”‚
â”‚  â”‚       "fs:write": "granted" | "denied",           â”‚     â”‚
â”‚  â”‚       "process:exec": "granted"                   â”‚     â”‚
â”‚  â”‚     }                                             â”‚     â”‚
â”‚  â”‚   }                                               â”‚     â”‚
â”‚  â”‚ }                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Plugin System                                     â”‚     â”‚
â”‚  â”‚ - PluginLoader                                    â”‚     â”‚
â”‚  â”‚ - PluginRegistry                                  â”‚     â”‚
â”‚  â”‚ - PermissionChecker (existing)                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æƒé™è¯·æ±‚æµç¨‹

### æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plugin calls â”‚
â”‚    API       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PermissionChecker    â”‚
â”‚ .checkPermission()   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ granted â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚
       â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execute API  â”‚                 â”‚ Return Error â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ denied â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚
       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return Error â”‚                 â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚              â”‚
       â”‚                         â”‚              â”‚
       â””â”€ pending â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                         â”‚      â”‚
                                         â–¼      â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Send IPC to  â”‚
                                â”‚ Renderer:    â”‚
                                â”‚ "Permission  â”‚
                                â”‚ Request"     â”‚
                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Show Dialog  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚              â”‚              â”‚
                        â–¼              â–¼              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Allow   â”‚   â”‚ Deny    â”‚   â”‚ Cancel  â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                        â”‚             â”‚             â”‚
                        â–¼             â–¼             â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚         â”‚
                   â”‚ IPC: grant/    â”‚     â”‚         â”‚
                   â”‚ deny           â”‚     â”‚         â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚         â”‚
                        â”‚                 â”‚         â”‚
                        â–¼                 â”‚         â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚         â”‚
                   â”‚ PermissionStoreâ”‚     â”‚         â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚         â”‚
                        â”‚                 â”‚         â”‚
                        â–¼                 â–¼         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Return to Plugin              â”‚
                   â”‚ (execute or error)            â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®ç»“æ„

### Permission Status

```typescript
enum PermissionStatus {
  PENDING = 'pending',   // æœªè¯¢é—®
  GRANTED = 'granted',   // å·²æˆäºˆ
  DENIED = 'denied'      // å·²æ‹’ç»
}

interface PluginPermissionState {
  pluginId: string
  permissions: Record<PluginPermission, PermissionStatus>
  requestedAt?: Record<PluginPermission, number> // æ—¶é—´æˆ³
}
```

### Permission Request

```typescript
interface PermissionRequest {
  pluginId: string
  permission: PluginPermission
  reason?: string  // ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæƒé™
  context?: {
    operation: string  // ä¾‹å¦‚: "å¤åˆ¶å¾®ä¿¡åº”ç”¨"
    target?: string    // ä¾‹å¦‚: "/Applications/WeChat2.app"
  }
}
```

### Permission Response

```typescript
interface PermissionResponse {
  granted: boolean
  permission: PluginPermission
  remember: boolean  // æ˜¯å¦è®°ä½é€‰æ‹©(ç›®å‰æ€»æ˜¯ true)
}
```

## IPC åè®®

### Main â†’ Renderer

#### Event: `permission:request`

```typescript
{
  pluginId: string
  permission: PluginPermission
  reason?: string
  context?: {
    operation: string
    target?: string
  }
}
```

#### Event: `permission:changed`

é€šçŸ¥æ¸²æŸ“è¿›ç¨‹æƒé™çŠ¶æ€å·²æ›´æ”¹(ä¾‹å¦‚ç”¨æˆ·åœ¨è®¾ç½®é¡µé¢æ’¤é”€æƒé™)

```typescript
{
  pluginId: string
  permission: PluginPermission
  status: PermissionStatus
}
```

### Renderer â†’ Main

#### IPC: `permission:response`

```typescript
{
  requestId: string
  granted: boolean
}
```

#### IPC: `permission:getStatus`

```typescript
// Request
{
  pluginId: string
}

// Response
{
  permissions: Record<PluginPermission, PermissionStatus>
}
```

#### IPC: `permission:revoke`

```typescript
{
  pluginId: string
  permission: PluginPermission
}
```

## UI è®¾è®¡

### æƒé™è¯·æ±‚å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ å¾®ä¿¡åˆ†èº«                      [Ã—]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  éœ€è¦ä»¥ä¸‹æƒé™æ‰èƒ½ç»§ç»­æ“ä½œ:                   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ æ–‡ä»¶å†™å…¥æƒé™                      â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ ä¸ºäº†åˆ›å»ºå¾®ä¿¡åˆ†èº«,éœ€è¦å°†å¾®ä¿¡åº”ç”¨      â”‚   â”‚
â”‚  â”‚ å¤åˆ¶åˆ° /Applications ç›®å½•ã€‚          â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ ç›®æ ‡ä½ç½®: /Applications/WeChat2.app  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  âš ï¸  æˆäºˆæ­¤æƒé™æ„å‘³ç€æ’ä»¶å¯ä»¥:              â”‚
â”‚  â€¢ åœ¨æ‚¨å…è®¸çš„ä½ç½®åˆ›å»ºå’Œä¿®æ”¹æ–‡ä»¶             â”‚
â”‚  â€¢ è®¿é—®å’Œå†™å…¥æ•æ„Ÿç³»ç»Ÿç›®å½•                   â”‚
â”‚                                             â”‚
â”‚  [è¯¦ç»†è¯´æ˜]                                 â”‚
â”‚                                             â”‚
â”‚           [æ‹’ç»]    [å…è®¸]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æƒé™ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ å¾®ä¿¡åˆ†èº«                    è¿”å›        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  æƒé™ç®¡ç†                                   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ æ–‡ä»¶å†™å…¥        â— å·²æˆäºˆ  [æ’¤é”€] â”‚   â”‚
â”‚  â”‚    ç”¨äºåˆ›å»ºå¾®ä¿¡åˆ†èº«å®ä¾‹               â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ âš™ï¸  è¿›ç¨‹æ‰§è¡Œ        â— å·²æˆäºˆ  [æ’¤é”€] â”‚   â”‚
â”‚  â”‚    ç”¨äºå¯åŠ¨å’Œç®¡ç†å¾®ä¿¡å®ä¾‹             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ âŒ è¿›ç¨‹ç»ˆæ­¢        â—‹ æœªæˆäºˆ  [æˆäºˆ] â”‚   â”‚
â”‚  â”‚    ç”¨äºç»ˆæ­¢è¿è¡Œçš„å¾®ä¿¡å®ä¾‹             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  æƒé™å†å²                                   â”‚
â”‚  â€¢ 2025-01-12 10:30 - æˆäºˆæ–‡ä»¶å†™å…¥æƒé™     â”‚
â”‚  â€¢ 2025-01-12 10:30 - æˆäºˆè¿›ç¨‹æ‰§è¡Œæƒé™     â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®‰å…¨è€ƒè™‘

1. **æƒé™æœ€å°åŒ–**: åªè¯·æ±‚å¿…éœ€çš„æƒé™
2. **æ˜ç¡®çš„åŸå› è¯´æ˜**: ç”¨æˆ·éœ€è¦çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦æƒé™
3. **å¯æ’¤é”€**: ç”¨æˆ·å¯ä»¥éšæ—¶æ’¤é”€æƒé™
4. **æŒä¹…åŒ–è®°å½•**: è®°å½•æƒé™æˆäºˆå†å²
5. **é˜²æ­¢æ»¥ç”¨**: åŒä¸€æƒé™åªè¯·æ±‚ä¸€æ¬¡,æ‹’ç»åä¸é‡å¤è¯·æ±‚

## é”™è¯¯å¤„ç†

### æƒé™è¢«æ‹’ç»æ—¶çš„é”™è¯¯ä¿¡æ¯

```typescript
class PermissionDeniedError extends Error {
  constructor(
    public pluginId: string,
    public permission: PluginPermission,
    public operation: string
  ) {
    super(
      `æ’ä»¶ ${pluginId} éœ€è¦ ${permission} æƒé™æ‰èƒ½ ${operation}ã€‚` +
      `è¯·åœ¨è®¾ç½®ä¸­æˆäºˆæƒé™æˆ–è”ç³»æ’ä»¶å¼€å‘è€…ã€‚`
    )
  }
}
```

### é™çº§å¤„ç†

- å¦‚æœå¯é€‰æƒé™è¢«æ‹’ç»,æ’ä»¶åº”è¯¥æä¾›é™çº§åŠŸèƒ½
- å¦‚æœå¿…éœ€æƒé™è¢«æ‹’ç»,æ’ä»¶åº”è¯¥æ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œå¸®åŠ©æ–‡æ¡£é“¾æ¥

## æ€§èƒ½è€ƒè™‘

1. æƒé™æ£€æŸ¥æ˜¯åŒæ­¥çš„,çŠ¶æ€å­˜å‚¨åœ¨å†…å­˜ä¸­
2. æŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ JSON æ–‡ä»¶,å¯åŠ¨æ—¶åŠ è½½
3. æƒé™çŠ¶æ€å˜æ›´äº‹ä»¶ä½¿ç”¨ IPC å¹¿æ’­,åŠæ—¶æ›´æ–°æ‰€æœ‰ç»„ä»¶

## æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**: PermissionManager çš„å„ä¸ªæ–¹æ³•
2. **é›†æˆæµ‹è¯•**: æƒé™è¯·æ±‚æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•
3. **UI æµ‹è¯•**: å¯¹è¯æ¡†æ¸²æŸ“å’Œäº¤äº’æµ‹è¯•
4. **å®‰å…¨æµ‹è¯•**: æƒé™ç»•è¿‡ã€æ³¨å…¥æ”»å‡»ç­‰
